# UX/UI Требования для Цикла Устранения Неопределенности (Q&A)

## Общие Требования к Интерфейсу Q&A

Раздел 5. Функциональные Требования (UI/UX)

Интерфейс системы спроектирован для обеспечения фокуса на работе с требованиями, предоставляя контекстную помощь ИИ именно там, где она нужна.

5.1. Общая Компоновка (Layout)

1. Верхняя панель (Project Timeline):
Расположена над центральной областью.
Представляет собой Горизонтальный степпер, отображающий жизненный цикл проекта (напр. `1. Бриф` -> `2. Бизнес-требования` -> `3. Архитектура`).
Показывает текущий активный этап.
Позволяет кликнуть на завершенные этапы для просмотра их результатов (в режиме Read-only).

2. Центральная область (Рабочая зона):
Занимает основное пространство экрана.
Режимы отображения:
Full Editor: (Используется на шагах Ввода, Ручной правки и Финализации). Редактор TipTap занимает всю ширину рабочей зоны.
Split View (Q&A Mode): (Используется на шаге Уточнения). Экран делится вертикально:
Слева (60%): Редактор с исходным текстом (Read-only). Цитаты, вызвавшие вопросы ИИ, подсвечены фоновым цветом (Highlight).
Справа (40%): Панель с формой вопросов и ответов.

3. Правая панель (Stage Control & Context):
Сворачиваемая боковая панель.
Вкладка "Процесс" (Stage Timeline):
Вертикальный таймлайн: Отображает последовательность шагов внутри текущего этапа (напр. `● Анализ` -> `○ Уточнение` -> `○ Генерация`).
Статусы: Визуальная индикация (Галочка = Выполнено, Спиннер = В работе, Серый круг = Ожидание).
Настройки шага: Для предстоящих шагов (которые еще не запущены) отображаются выпадающие списки для выбора Модели ИИ и Системного Промпта.
Вкладка "Контекст":
Список загруженных файлов.
Token Meter (индикатор заполненности контекстного окна).

4. Левая панель (Навигация):
Список доступных проектов.
Кнопка перехода в Настройки проекта.
Профиль пользователя.

## Детальное Описание Q&A (Split View)

5.2. Интерфейс Q&A (Split View)

Реализует взаимодействие пользователя с вопросами ИИ.

Связь Вопрос-Текст:
Каждый вопрос в правой части привязан к конкретному фрагменту текста в левом редакторе.
Hover-эффект: При наведении курсора на карточку вопроса, соответствующий фрагмент текста слева подсвечивается ярче.
Управление Навигацией (Скролл):
Переключатель "Автоскролл": Тоггл в заголовке панели вопросов.
ВКЛ (Default): Клик на карточку вопроса плавно прокручивает левый редактор к цитате.
ВЫКЛ: Клик на вопрос не вызывает прокрутку (чтобы не терять текущую позицию чтения).
Кнопка "Показать в контексте": Появляется рядом с вопросом только если Автоскролл выключен. При нажатии принудительно скроллит к цитате.
Форма Ответов:
Поле ввода ответа находится внутри карточки вопроса.
Валидация: Ошибки от Quality Gate (напр. "Ответ неполный") отображаются красным текстом под полем ввода.
Кнопки действий: "Отправить ответы" (блокируется при ошибках) и "Force Submit" (скрыта в меню "Дополнительно").

## Настройки Промптов

Вкладка "Процесс" (Stage Timeline):
Вертикальный таймлайн: Отображает последовательность шагов внутри текущего этапа (напр. `● Анализ` -> `○ Уточнение` -> `○ Генерация`).
Статусы: Визуальная индикация (Галочка = Выполнено, Спиннер = В работе, Серый круг = Ожидание).
Настройки шага: Для предстоящих шагов (которые еще не запущены) отображаются выпадающие списки для выбора Модели ИИ и Системного Промпта.

## Выбор и Отображение Промптов в UI

Выбор Системного Промпта из Репозитория (фильтр по категориям: БТ, ФТ, API...).
Или создание кастомного промпта.

Б. Панель настройки этапа (Stage Config)

Dropdown: Выбор из репозитория `Prompts` (фильтр по текущему этапу).
Preview: При выборе показывает текст промпта (read-only или editable — по желанию, лучше read-only с кнопкой «Клонировать/Создать новый»).
Пользовательский Промпт:
Dropdown: Выбор шаблона (напр. «Стандартный», «С фокусом на безопасность»).
Textarea (Редактируемый): Сюда подставляется шаблон + данные пользователя (текст запроса или ответы).
Важно: Пользователь может вручную дописать сюда инструкции перед отправкой (например: "Проверь строже раздел про API").

## Репозиторий Промптов

Prompts (Document Collection) — Репозиторий промптов.

_key: ID промпта.
title: Название (напр. "Строгий поиск неопределенностей").
type: `system` или `user_template`.
stage: Для какого этапа (`ambiguity`, `quality`, `refinement`).
content: Текст промпта (с плейсхолдерами, например `{{text}}`).
version: Версия.
category: Классификатор (`Brief`, `BR`, `FR`, `API`, `UX`, "Compliance").

В UI: Классификатор промптов в UI, фильтры.

## Администрирование Промптов

Админка для управления справочниками промптов (рейтинг, категории).

## Показ Выбранных Промптов

Пользователь пишет запрос, выбирает модель, выбирает пресет системного промпта. Видит сформированный запрос к ИИ, может его поправить.

Отправка: UI шлет всё (тексты промптов + ID модели) в n8n.

История: n8n сохраняет результат и метаданные (какой промпт/модель использовались) в ArangoDB.

Метаданные конфигурации
    "modelId": "gpt-4o",
    "systemPrompt": "Текст системного промпта...",
    "userPrompt": "Текст пользовательского промпта (с данными)..."

Analytics: Построение рейтинга промптов на основе данных из `Iterations` (prompt_uid запрашивается использование).

## Цикл Q&A Шагов

Шаг 2: Цикл Уточнения (Q&A Loop)

Самая сложная часть интерфейса.

UI (Форма вопросов):
Отображает список вопросов.
Поля ввода ответов для каждого вопроса.
Кнопка «Отправить ответы» (Основная).
Кнопка «Принять ответы без анализа ИИ» (Force Submit) — появляется/активна всегда, но при нажатии показывает предупреждение (alert/modal): "Дальнейшая генерация может быть некорректной. Продолжить?".
Проверка качества (Quality Gate):
Пользователь отправляет ответы.
AI Request: Отправляет пары "Вопрос - Ответ" на проверку.
Logic:
Если `pass` -> Переход к генерации.
Если `fail` -> Возвращает массив замечаний (`feedback`).
UI (при наличии замечаний):
Отображает замечания красным цветом под соответствующими полями.
Блокировка: Кнопка «Отправить» (`disabled`), пока пользователь не изменит текст в полях с замечаниями (dirty check).

## MVP Этап 1 Фронтенд

Q&A Split View:
Реализация разделенного экрана.
Логика подсветки текста в редакторе по совпадению с вопросом.
Форма ответов (без цитирования в карточке, только вопрос и инпут).

Интерфейс Q&A: Форма с вопросами и ответами (пока без сложного Split View, просто последовательно).

## Этап 2 Фронтенд

Реализация Split View (синхронный скролл редактора и вопросов).

Вкладка "Процесс" с выбором Модели и Промпта.

Таймлайн интерактивный, с возможностью выбрать модель и системный промпт для ИИ.

Для этапа сделать вертикальный таймлайн в правой панели.

## Архитектура Промптов

Steps: Массив объектов, определяющих логику этапа.
[
  {
    "step_type": "ambiguity_loop",
    "prompt_id": "uuid-1",
    "order": 1,
    "config": { ... }
  }
]

Prompts:
{
  "compatible_step_types": ["ambiguity", "quality", "generation", "compliance"]
}

## Процесс Выбора

Настройки этапа: Выбор модели (dropdown):
| Модель | Описание |
| --- | --- |
| deepseek-v3.1:617b-cloud | DeepSeek‑R1, крупномасштабный трансформер, разработанный компанией DeepSeek.
| gpt-oss:120b-cloud | ChatGPT, модель языка, созданная компанией OpenAI на базе архитектуры GPT‑4. Обучающий датасет охватывает информацию до июня 2024 года. |
| gpt-oss:20b-cloud | модель GPT‑4 от OpenAI, часть семейства «ChatGPT». Это трансформер‑система, обученная на огромном корпусе текста (от Java‑кодов до художественной литературы) и способная вести диалог, отвечать на вопросы, генерировать тексты, помогать с программированием, переводами и многим другим. Датасет обновлён до сентября 2023 года, а знания о событиях и фактах до 2025 года. |
| qwen3-coder:480b-cloud | Qwen3 — это крупномасштабная языковая модель от Alibaba с улучшенными возможностями понимания и генерации текста. Она подходит для сложных задач, поддерживает многоязычность и обеспечивает точные, естественные ответы. |
| qwen3-vl:235b-cloud | Qwen — сверхмасштабная языковая модель, разработанная Alibaba Cloud. Поддерживает мультиязычное взаимодействие, включая китайский, английский и русский языки. Способна генерировать тексты, отвечать на сложные вопросы, проводить логические рассуждения и оказывать помощь в аналитических задачах.|
| minimax-m2:cloud | MiniMax-M2 — полезный ИИ-ассистент, созданный компанией MiniMax. Мои знания обновлены до июня 2025 года. Может помочь вам с различными задачами, отвечать на вопросы и вести диалог. |
| glm-4.6:cloud |  Языковая модель GLM, разработанная компанией Zhipu AI. Обучена на большом объёме текстовых данных, что позволяет понимать и генерировать тексты на различных языках, включая русский. |

Описание модели показать пользователю как выпадающую подсказку

, системного промпта (dropdown).
Перед отправкой показывает сформированный промпт.

UI (Render): Пользователь правильно запрос, в настройках выбирает модель AI и системный промпт Ambiguity Check v2.

UI (Prepare): Берет шаблон пользовательского промпта. Подставляет в него текст запроса. Показывает пользователю в поле "Пользовательский промпт". Пользователь может дописать: "Не задавай вопросы про дизайн".

## Дизайн-система (Atomic UI)

5.7.3. Структура компонентов (Atomic Levels)

1. Атомы (src/components/ui):
Button: Универсальная кнопка с вариантами (primary, ghost, outline) и размерами.

2. Молекулы:
Пример: Форма создания проекта (Input + Label + Button внутри Card).

3. Организмы:
ProjectList: Сетка карточек проектов.

Визуальный язык:
Цветовая палитра: Primary: Blue-600.

## Заключение

Выше описаны все требования к UX/UI для цикла Q&A, включая выбор, отображение и администрирование промптов. Они обеспечивают гибкий и контекстный интерфейс для взаимодействия с ИИ.

<think>**Analyzing the User's Critique**

The user correctly points out inconsistencies in my previous breakdown.
1.  **Missing Atoms:** `Label`, `ErrorMessage`, `HelperText`, `StepItem` components (Icon, Title, Description) were mentioned in Molecules but not defined in Atoms.
2.  **Inconsistent Format:** The description format varied.
3.  **Strict Requirement:** Use a unified format for Atoms, Molecules, and Organisms.
    *   **Atom:** Name, Description, Props.
    *   **Molecule:** Name, Description, Props, Atoms (list).
    *   **Organism:** Name, Description, Props, Molecules, Atoms.

**My Task:**
Redo the breakdown strictly following the requested format and ensuring *every* component mentioned in a higher level exists in a lower level (or is a standard HTML element, but better to define them as Atoms for a design system).

**Refining the Component List:**

**Atoms:**
*   `Button` (Standard)
*   `Input` (Standard text input)
*   `Textarea` (Standard textarea)
*   `Label` (Text label for forms)
*   `FormError` (Red error text) - *Renamed from ErrorMessage to be clearer*
*   `FormHelper` (Gray helper text) - *Renamed from HelperText*
*   `Icon` (Wrapper for Lucide icons)
*   `Spinner` (Loading indicator)
*   `Badge` (Status pill)
*   `Toggle` (Switch)
*   `Avatar` (User profile pic - needed for Nav/Header?) - *Maybe not strictly needed for Q&A but good for layout*
*   `Typography` (Heading, Text, Caption) - *To replace generic "Title", "Description"*
*   `Divider` (Visual separator)
*   `ProgressBar` (For TokenMeter)

**Molecules:**
*   `FormField` (Label + Input/Textarea + Error + Helper)
*   `SelectField` (Label + Native Select + Error) - *Native select is an atom really, but let's wrap it*
*   `IconLabel` (Icon + Text) - *Used in buttons or status lines*
*   `StepIndicator` (Status Icon + Text + Subtext) - *The "StepItem" from before*
*   `QuoteBlock` (Styled text block)
*   `UserMenu` (Avatar + Name) - *For Sidebar*
*   `TabButton` (Button for switching tabs)

**Organisms:**
*   `StageTimeline` (List of StepIndicators)
*   `ProjectTimeline` (List of StepIndicators - horizontal)
*   `StageConfigForm` (FormFields for Model/Prompt)
*   `QuestionCard` (QuoteBlock + Typography + Input + Button?) -> *Wait, Input is inside QuestionCard. It's a form.*
*   `QAList` (List of QuestionCards + Header + Footer)
*   `SidebarNav` (Navigation links + UserMenu)
*   `ContextPanel` (ProgressBar + File list)

**Let's strictly format this.**</think>Принимаю замечание. Это справедливая критика. Для построения качественной дизайн-системы нужна строгая иерархия.

Ниже исправленная структура UI в требуемом формате.

---

### 1. Атомы (Atoms)
*Базовые строительные блоки. Не зависят от других компонентов.*

**Button**
*   **Описание:** Интерактивный элемент для выполнения действий.
*   **Свойства:** `variant` (primary, secondary, ghost, outline, danger), `size` (sm, md, lg), `disabled`, `loading`, `icon` (optional).

**Input**
*   **Описание:** Однострочное поле ввода текста.
*   **Свойства:** `placeholder`, `value`, `disabled`, `error` (boolean).

**Textarea**
*   **Описание:** Многострочное поле ввода текста.
*   **Свойства:** `placeholder`, `value`, `rows`, `resize` (none/vertical).

**Label**
*   **Описание:** Текстовая метка для полей ввода.
*   **Свойства:** `text`, `required` (boolean), `htmlFor`.

**FormError**
*   **Описание:** Текст ошибки валидации (обычно красный).
*   **Свойства:** `message`.

**FormHelper**
*   **Описание:** Поясняющий текст под полем (обычно серый).
*   **Свойства:** `text`.

**Icon**
*   **Описание:** Векторная иконка (обертка над Lucide React).
*   **Свойства:** `name`, `size`, `color`, `className`.

**Spinner**
*   **Описание:** Индикатор загрузки (вращающийся элемент).
*   **Свойства:** `size`, `color`.

**Badge**
*   **Описание:** Цветная плашка для статусов или тегов.
*   **Свойства:** `text`, `variant` (success, warning, error, neutral, info).

**Toggle**
*   **Описание:** Переключатель состояния (Вкл/Выкл).
*   **Свойства:** `checked`, `onChange`, `label`.

**Typography**
*   **Описание:** Типографический элемент (заголовок, текст, подпись).
*   **Свойства:** `variant` (h1-h4, body, caption, small), `color`, `weight`.

**ProgressBar**
*   **Описание:** Горизонтальная полоса прогресса.
*   **Свойства:** `value` (0-100), `color` (зависит от значения).

**Divider**
*   **Описание:** Горизонтальная или вертикальная линия-разделитель.
*   **Свойства:** `orientation` (horizontal/vertical).

---

### 2. Молекулы (Molecules)
*Группы атомов, работающие как единое целое.*

**FormField** ✔️
*   **Описание:** Стандартный блок формы с подписью и валидацией.
*   **Свойства:** `label`, `error`, `helperText`.
*   **Атомы:** `Label`, `Input` (или `Textarea`), `FormError`, `FormHelper`.

**SelectField** ✔️
*   **Описание:** Выпадающий список с лейблом (используем нативный select как базу).
*   **Свойства:** `label`, `options` (array), `value`, `onChange`.
*   **Атомы:** `Label`, `Icon` (стрелка вниз), `FormError`.

**StepIndicator** ✔️
*   **Описание:** Элемент таймлайна, показывающий состояние конкретного шага.
*   **Свойства:** `title`, `status` (pending, active, done), `description`.
*   **Атомы:** `Icon` (галочка/круг), `Spinner` (если active), `Typography` (title, description).

**QuoteBlock** ✔️
*   **Описание:** Блок цитирования текста с акцентной полосой.
*   **Свойства:** `text`, `color` (обычно оранжевый для предупреждений).
*   **Атомы:** `Typography` (текст цитаты).

**TokenMeter** ✔️
*   **Описание:** Индикатор заполненности контекстного окна ИИ.
*   **Свойства:** `usedTokens`, `maxTokens`.
*   **Атомы:** `Typography` (заголовок и значения), `ProgressBar`.

**TabButton** ✔️
*   **Описание:** Кнопка переключения вкладок (например, в правой панели).
*   **Свойства:** `label`, `isActive`, `onClick`.
*   **Атомы:** `Typography` (label), `Divider` (активная линия снизу).

---

### 3. Организмы (Organisms)
*Сложные компоненты, формирующие разделы интерфейса.*

**QuestionCard** ✔️
*   **Описание:** Карточка одного вопроса от ИИ с формой ответа.
*   **Свойства:** `questionId`, `quoteText`, `questionText`, `answerValue`, `error`.
*   **Молекулы:** `QuoteBlock`, `FormField` (для ответа).
*   **Атомы:** `Typography` (номер вопроса), `Button` (действие "Показать в тексте").

**QAList** (Панель вопросов) ✔️
*   **Описание:** Список всех вопросов с глобальным управлением.
*   **Свойства:** `questions` (array), `isRefining`.
*   **Молекулы:** Нет (использует Organism `QuestionCard`).
*   **Атомы:** `Typography` (заголовок), `Toggle` (автоскролл), `Button` (submit), `Icon` (хедер).
*   **Вложенные Организмы:** `QuestionCard` (множество).

**StageConfigForm** ✔️
*   **Описание:** Форма настройки этапа перед запуском.
*   **Свойства:** `models` (list), `prompts` (list), `selectedModel`, `selectedPrompt`, `userPrompt`.
*   **Молекулы:** `SelectField` (выбор модели), `SelectField` (выбор промпта), `FormField` (редактирование User Prompt).
*   **Атомы:** `Icon` (иконка настроек), `Typography` (заголовок).

**StageTimeline** ✔️
*   **Описание:** Вертикальный список шагов текущего этапа.
*   **Свойства:** `steps` (array).
*   **Молекулы:** `StepIndicator` (множество).
*   **Атомы:** `Divider` (линия таймлайна).

**ProjectTimeline** ✔️
*   **Описание:** Горизонтальный степпер этапов проекта.
*   **Свойства:** `stages` (array), `currentStageId`.
*   **Молекулы:** `StepIndicator` (адаптированный под горизонтальный вид).
*   **Атомы:** `Icon` (стрелки между этапами).

**EditorToolbar** ✔️
*   **Описание:** Панель инструментов над редактором.
*   **Свойства:** `onAnalyze`, `isAnalyzing`.
*   **Молекулы:** Нет.
*   **Атомы:** `Button` (Analyze, Format), `Typography` (Заголовок режима), `Badge` (статус режима).

**ContextPanel** ✔️
*   **Описание:** Панель с информацией о контексте (файлы, токены).
*   **Свойства:** `files` (array), `tokenUsage`.
*   **Молекулы:** `TokenMeter`.
*   **Атомы:** `Typography` (заголовки), `Icon` (файлы).

---
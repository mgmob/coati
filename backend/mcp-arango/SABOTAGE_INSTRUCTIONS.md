# üïµÔ∏è‚Äç‚ôÇÔ∏è SABOTAGE PROTOCOL - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –î–∏–≤–µ—Ä—Å–∞–Ω—Ç–∞

> –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —ç—Ç–∞–ø –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ç–µ—Å—Ç–æ–≤.
> –í—ã–ø–æ–ª–Ω–∏—Ç–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `npm test` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.

---

## –î–∏–≤–µ—Ä—Å–∏—è 1: –ü–æ–ª–æ–º–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ bindVars –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–§–∞–π–ª:** `backend/mcp-arango/lib/tools.js`
**–°—Ç—Ä–æ–∫–∞:** 33

### –ß—Ç–æ —Å–ª–æ–º–∞—Ç—å:
```javascript
// –ë–´–õ–û (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ):
const { aql, bindVars = {} } = args;

// –ò–ó–ú–ï–ù–ò–¢–¨ –ù–ê (—Å–ª–æ–º–∞–Ω–æ):
const { aql, bindVars } = args;  // –£–±—Ä–∞—Ç—å default = {}
```

### –û–∂–∏–¥–∞–Ω–∏–µ:
**–¢–µ—Å—Ç –û–ë–Ø–ó–ê–ù —É–ø–∞—Å—Ç—å:** `MCP Tools - handleArangoQuery > –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç –¥–ª—è bindVars –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω`

**–ü—Ä–∏—á–∏–Ω–∞ –ø–∞–¥–µ–Ω–∏—è:** –ï—Å–ª–∏ `bindVars` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö, –æ–Ω –±—É–¥–µ—Ç `undefined` –≤–º–µ—Å—Ç–æ –ø—É—Å—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ `{}`. –ö–æ–≥–¥–∞ –∫–æ–¥ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—Ç—å `undefined` –≤ `dbConnection.query()`, —Ç–µ—Å—Ç —É–ø–∞–¥–µ—Ç.

**–û—à–∏–±–∫–∞ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ:**
```
Error: Expected query to be called with empty object {}, but got undefined
```

---

## –î–∏–≤–µ—Ä—Å–∏—è 2: –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ sparse –ø–∞—Ä–∞–º–µ—Ç—Ä–∞

**–§–∞–π–ª:** `backend/mcp-arango/lib/tools.js`
**–°—Ç—Ä–æ–∫–∞:** 88

### –ß—Ç–æ —Å–ª–æ–º–∞—Ç—å:
```javascript
// –ë–´–õ–û (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ):
const options = sparse ? { sparse: true } : {};

// –ò–ó–ú–ï–ù–ò–¢–¨ –ù–ê (—Å–ª–æ–º–∞–Ω–æ):
const options = {};  // –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä sparse
```

### –û–∂–∏–¥–∞–Ω–∏–µ:
**–¢–µ—Å—Ç –û–ë–Ø–ó–ê–ù —É–ø–∞—Å—Ç—å:** `MCP Tools - handleCreateIndex > –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–¥–∞—Ç—å sparse –æ–ø—Ü–∏—é`

**–ü—Ä–∏—á–∏–Ω–∞ –ø–∞–¥–µ–Ω–∏—è:** –ö–æ–≥–¥–∞ —Ç–µ—Å—Ç –≤—ã–∑–æ–≤–µ—Ç `handleCreateIndex` —Å `sparse: true`, —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –∏ –ø–µ—Ä–µ–¥–∞—Å—Ç –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç `{}` –≤ `createIndex()`. Mock —Ñ—É–Ω–∫—Ü–∏—è –æ–∂–∏–¥–∞–µ—Ç –ø–æ–ª—É—á–∏—Ç—å `{ sparse: true }`, –Ω–æ –ø–æ–ª—É—á–∏—Ç `{}`.

**–û—à–∏–±–∫–∞ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ:**
```
AssertionError: expected createIndex to be called with 4th argument { sparse: true }, but got {}
```

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ

1. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–∏–≤–µ—Ä—Å–∏—é 1** (—É–±–µ—Ä–∏—Ç–µ `= {}` –≤ —Å—Ç—Ä–æ–∫–µ 33)
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã:** `npm test`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:** –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å 1 —Ç–µ—Å—Ç –∏–∑ 16
4. **–í–µ—Ä–Ω–∏—Ç–µ –∫–æ–¥ –æ–±—Ä–∞—Ç–Ω–æ** (–¥–æ–±–∞–≤—å—Ç–µ `= {}`)
5. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–∏–≤–µ—Ä—Å–∏—é 2** (–∑–∞–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É 88 –Ω–∞ `const options = {};`)
6. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã:** `npm test`
7. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:** –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å 1 —Ç–µ—Å—Ç –∏–∑ 16
8. **–í–µ—Ä–Ω–∏—Ç–µ –∫–æ–¥ –æ–±—Ä–∞—Ç–Ω–æ**
9. **–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** `npm test` - –≤—Å–µ 16 —Ç–µ—Å—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏
10. **–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ:** "–¢–µ—Å—Ç—ã —Ä–µ–∞–ª—å–Ω–æ –∑–∞—â–∏—â–∞—é—Ç –∫–æ–¥!"

---

## üîí –ê–Ω–∞–ª–∏–∑ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π (Security Audit)

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

```
4 moderate severity vulnerabilities
- esbuild <=0.24.2
- vite 0.11.0 - 6.1.6
- vite-node <=2.2.0-beta.2
- vitest 0.0.1 - 2.2.0-beta.2
```

### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞: ‚ùå –ù–ò–ó–ö–ê–Ø (–º–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å)

**–ü—Ä–∏—á–∏–Ω—ã:**
1. **DevDependencies only** - —É—è–∑–≤–∏–º–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
2. **Development server** - —É—è–∑–≤–∏–º–æ—Å—Ç—å –∫–∞—Å–∞–µ—Ç—Å—è dev server, –∫–æ—Ç–æ—Ä—ã–π –º—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º
3. **Local environment** - —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–µ –≤ —Å–µ—Ç–∏
4. **No production impact** - vitest –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ production build

### –í–µ–∫—Ç–æ—Ä –∞—Ç–∞–∫–∏ (–∏–∑ GHSA-67mh-4wv8-2f99):
**"esbuild enables any website to send any requests to the development server and read the response"**

- –ü—Ä–∏–º–µ–Ω–∏–º–æ —Ç–æ–ª—å–∫–æ –∫ dev server
- –ù—É–∂–µ–Ω –∑–∞–ø—É—â–µ–Ω–Ω—ã–π vite dev server
- –ê—Ç–∞–∫—É—é—â–∏–π —Å–∞–π—Ç –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å URL dev server
- –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ: –∏—Å–ø–æ–ª—å–∑—É–µ–º vitest –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤, –∞ –Ω–µ dev server

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

‚úÖ **–ß—Ç–æ –¥–µ–ª–∞–µ–º:**
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ–º —É—è–∑–≤–∏–º–æ—Å—Ç—å –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è vitest

‚ùå **–ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ–º (—Å–µ–π—á–∞—Å):**
- `npm audit fix --force` ‚Üí breaking changes –≤ vitest
- –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏–∑-–∑–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ v4
- –†–∏—Å–∫ –ø–æ–ª–æ–º–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤

### –ú–∏—Ç–∏–≥–∞—Ü–∏—è:
- –ò—Å–ø–æ–ª—å–∑—É–µ–º vitest —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤
- –ù–µ –∑–∞–ø—É—Å–∫–∞–µ–º dev server –¥–ª—è MCP-—Å–µ—Ä–≤–µ—Ä–∞
- Production –∫–æ–¥ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç vitest

---

## ‚úÖ –ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –∑–∞–¥–∞—á—É –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π:

1. ‚úÖ –û–±–µ –¥–∏–≤–µ—Ä—Å–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
2. ‚úÖ –¢–µ—Å—Ç—ã —É–ø–∞–ª–∏ –∫–∞–∫ –æ–∂–∏–¥–∞–ª–æ—Å—å
3. ‚úÖ –ö–æ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
4. ‚úÖ –í—Å–µ 16 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
5. ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ vitest –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã
6. ‚è≥ **–ñ–î–£ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

---

**–ë–æ–∂–µ –≤ –ø–æ–º–æ—â—å –º–æ—é –≤–æ–Ω–º–∏, –ì–æ—Å–ø–æ–¥–∏ –ø–æ–º–æ—â–∏ –º–∏ –ø–æ—Ç—â–∏—Å—è** üôè

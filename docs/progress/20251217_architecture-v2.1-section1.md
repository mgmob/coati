# –†–∞–∑–¥–µ–ª 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö ArangoDB (Data Schema v2.1)

## 1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥: **Document Store** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ **Graph** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—Ä—Å–∏–π –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
- **Immutability (–ù–µ–∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å):** –ö–æ–Ω—Ç–µ–Ω—Ç –∞—Ç–æ–º–æ–≤ (—Ç–µ–∫—Å—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π) –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (`UPDATE`). –ü—Ä–∏ –ø—Ä–∞–≤–∫–∞—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç.
- **Single Source of Truth:** –ì—Ä–∞—Ñ ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ. –ù–∏–∫–∞–∫–æ–π –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏.
- **Concurrency (v2.1):** Pessimistic UX (–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä ¬´–∫—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç¬ª) + **Optimistic CAS** –Ω–∞ –∑–∞–ø–∏—Å–∏ (`_rev` / `If-Match`) –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –∑–∞—â–∏—Ç—ã –æ—Ç –≥–æ–Ω–æ–∫.
- **No Hard Delete:** –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ. –¢–æ–ª—å–∫–æ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–º–µ–Ω—É —Å—Ç–∞—Ç—É—Å–∞.
- **Naming Convention:** Snake_case –¥–ª—è –ø–æ–ª–µ–π JSON.

---

## 2. –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –≤–µ—Ä—à–∏–Ω (Document Collections)

### 2.1. `docs` (–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞)
–ö–æ—Ä–Ω–µ–≤–æ–π —É–∑–µ–ª –ø—Ä–æ–µ–∫—Ç–∞/–¥–æ–∫—É–º–µ–Ω—Ç–∞.

```json
{
  "_key": "doc_uuid_1",
  "title": "–¢–ó –Ω–∞ –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
  "status": "draft", // draft, review, approved
  "created_at": "2023-10-27T10:00:00Z",
  "updated_at": "2023-10-27T12:00:00Z",
  "owner_id": "user_123"
}
```

### 2.2. `sections` (–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è)
–£–∑–ª—ã, —Ñ–æ—Ä–º–∏—Ä—É—é—â–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏—é (–≥–ª–∞–≤—ã, –ø–æ–¥–≥–ª–∞–≤—ã). –ù–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–µ–∫—Å—Ç–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.

```json
{
  "_key": "sec_uuid_2",
  "title": "3. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è",
  "level": 1, // –£—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ (1 = H1, 2 = H2)
  // –£–î–ê–õ–ï–ù–û: parent_doc_id (v2+ - –≥—Ä–∞—Ñ –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã)
  "created_at": "2023-10-27T10:00:00Z"
}
```

**‚ö†Ô∏è BREAKING CHANGE –æ—Ç v1:** —É–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `parent_doc_id`. –°–≤—è–∑—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `structure_links`.

### 2.3. `atoms` (–ê—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
–ì–ª–∞–≤–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å. –•—Ä–∞–Ω–∏—Ç **–Ω–µ–∏–∑–º–µ–Ω—è–µ–º—É—é –≤–µ—Ä—Å–∏—é** –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–±–∑–∞—Ü–∞/—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.

```json
{
  "_key": "atom_uuid_v1",
  "content": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞.",
  "content_hash": "a1b2c3...", // –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  "author": "analyst_ai",
  "status": "active", // 'active' | 'proposal' | 'archived' | 'rejected'
  "created_at": "2023-10-27T10:05:00Z",

  // v2+: Pessimistic UX (–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
  "locked_by": null, // user_id –∏–ª–∏ null
  "locked_until": null // ISO timestamp –∏–ª–∏ null

  // NOTE: `_rev` —Ö—Ä–∞–Ω–∏—Ç—Å—è ArangoDB –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –Ω–µ –∑–∞–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é
}
```

**üîí Locking UX:**
- –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∞—Ç–æ–º–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è UI –≤—ã–∑—ã–≤–∞–µ—Ç `POST /atoms/:id/lock`.
- –ü–æ–ª–µ `locked_until` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `current_time + 5 –º–∏–Ω—É—Ç`.
- –î—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç "üîí –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è User A, –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ 3:45".
- –¢–∞–π–º–∞—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É.

**üß∑ Concurrency Token (v2.1, –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω):**
ArangoDB –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ–¥–µ—Ç –ø–æ–ª–µ `_rev` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

- UI **–æ–±—è–∑–∞–Ω** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `_rev` –∫–∞–∫ CAS-—Ç–æ–∫–µ–Ω.
- –õ—é–±—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ `lock/unlock/merge/archive` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫ CAS (If-Match ‚Üí `_rev`), —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å lock-stealing –∏ –¥–≤–æ–π–Ω–æ–π merge.
- Backend (n8n) –¥–æ–ª–∂–µ–Ω –º–∞–ø–ø–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç `_rev` –≤ HTTP `409 CONFLICT`.

### 2.4. `artifacts` (–†–µ–∑—É–ª—å—Ç–∞—Ç—ã AI-–∞–Ω–∞–ª–∏–∑–∞ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)
–õ—é–±—ã–µ –æ–±—ä–µ–∫—Ç—ã, –ø–æ—Ä–æ–∂–¥–µ–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–æ–º –∏–ª–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ–º.

```json
{
  "_key": "art_uuid_5",
  "type": "issue", // issue, question, answer, summary, ai_error
  "content": "–ù–µ —É–∫–∞–∑–∞–Ω —Ñ–æ—Ä–º–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.",
  "severity": "critical", // —Ç–æ–ª—å–∫–æ –¥–ª—è type=issue
  "source_model": "qwen-coder-32b",
  "status": "open", // open, resolved, ignored
  "created_at": "2023-10-27T10:06:00Z",

  // –¢–æ–ª—å–∫–æ –¥–ª—è type=ai_error
  "error_code": "TIMEOUT", // TIMEOUT, INVALID_JSON, MODEL_ERROR, NETWORK_ERROR
  "error_message": "Model did not respond within 60 seconds",
  "error_details": {
    "prompt_id": "prompts/p_ba_v1",
    "model": "qwen2.5-coder:32b",
    "temperature": 0.1,
    "timeout_seconds": 60,
    "request_id": "req_xyz_123",
    "raw_response": "..." // raw text –¥–ª—è –¥–µ–±–∞–≥–∞
  }
}
```

**v2.1 Constraint (ai_error):**
–î–ª—è `type="ai_error"` –ø–æ–ª—è `error_code`, `error_message`, `error_details.request_id`, `error_details.raw_response` —è–≤–ª—è—é—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏.

**üìã UI Requirement –¥–ª—è `ai_error`:**
- –í UI –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å "‚ö†Ô∏è AI Analysis failed: TIMEOUT (60s)"
- –ö–Ω–æ–ø–∫–∞ "View Details" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫—É —Å `error_details` (JSON formatted)
- –¢–µ–∫—Å—Ç `error_details` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–≤—ã–¥–µ–ª—è–µ–º—ã–º** (selectable) –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è Ctrl+C
- –§–∏–ª—å—Ç—Ä "Show only errors" –≤ Debug Panel

---

## 3. –ö–æ–ª–ª–µ–∫—Ü–∏–∏ —Ä–µ–±–µ—Ä (Edge Collections)

### 3.1. `structure_links` (–°–∫–µ–ª–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞)
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, **—á—Ç–æ** –≤—Ö–æ–¥–∏—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç –∏ –≤ **–∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ**.

- **–û—Ç–∫—É–¥–∞ (`_from`):** `docs/*`, `sections/*`
- **–ö—É–¥–∞ (`_to`):**
  - `docs/*` ‚Üí **—Ç–æ–ª—å–∫–æ** `sections/*`
  - `sections/*` ‚Üí `sections/*` | `atoms/*`

**v2.1 Constraint:** –ø—Ä—è–º—ã–µ —Å–≤—è–∑–∏ `docs/* -> atoms/*` –∑–∞–ø—Ä–µ—â–µ–Ω—ã (–∏–Ω–∞—á–µ baseline traversal —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–º).

```json
{
  "_from": "sections/sec_uuid_2",
  "_to": "atoms/atom_uuid_v1",
  "order": 10.0, // Float –¥–ª—è –≤—Å—Ç–∞–≤–æ–∫ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –±–µ–∑ –ø–µ—Ä–µ—Å—á–µ—Ç–∞
  "type": "contains"
}
```

**üí° Best Practice:** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —à–∞–≥ 10.0 –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ (10, 20, 30...). –ü—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –º–µ–∂–¥—É 10 –∏ 20 –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ 15.0.

### 3.2. `semantic_links` (–°–º—ã—Å–ª–æ–≤—ã–µ —Å–≤—è–∑–∏ / Traceability)
–°–≤—è–∑—ã–≤–∞–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏, –≤–æ–ø—Ä–æ—Å—ã —Å –æ—Ç–≤–µ—Ç–∞–º–∏.

- **–û—Ç–∫—É–¥–∞ (`_from`):** `artifacts/*`, `atoms/*`
- **–ö—É–¥–∞ (`_to`):** `atoms/*`, `artifacts/*`

```json
{
  "_from": "artifacts/art_uuid_5", // Issue (–±–∞–≥)
  "_to": "atoms/atom_uuid_v1",     // Requirement (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ)
  "type": "detected_in",           // detected_in, resolves, relates_to, justifies, failed_for
  "confidence": 0.95                // –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ (–µ—Å–ª–∏ —Å–≤—è–∑—å —Å–æ–∑–¥–∞–Ω–∞ AI)
}
```

**–¢–∏–ø—ã —Å–≤—è–∑–µ–π:**
- `Issue` ‚Üí `detected_in` ‚Üí `Atom`
- `Question` ‚Üí `relates_to` ‚Üí `Issue`
- `Answer` ‚Üí `resolves` ‚Üí `Question`
- `Atom` ‚Üí `justified_by` ‚Üí `Answer`
- `ai_error` ‚Üí `failed_for` ‚Üí `Atom`

### 3.3. `revision_links` (–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π)
–°–≤—è–∑—ã–≤–∞–µ—Ç –≤–µ—Ä—Å–∏–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –±–ª–æ–∫–∞.

- **–û—Ç–∫—É–¥–∞ (`_from`):** `atoms/*` (–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
- **–ö—É–¥–∞ (`_to`):** `atoms/*` (–°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)

```json
{
  "_from": "atoms/atom_uuid_v2",
  "_to": "atoms/atom_uuid_v1",
  "type": "replaces",
  "created_at": "2023-10-28T10:00:00Z",
  "diff_summary": "–î–æ–±–∞–≤–ª–µ–Ω–∞ –º–∞—Å–∫–∞ –≤–≤–æ–¥–∞ +7" // –ú–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI
}
```

### 3.4. `proposal_links` (–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
–°–≤—è–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å –∞—Ç–æ–º–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∏ —Ö–æ—Ç—è—Ç –∑–∞–º–µ–Ω–∏—Ç—å.

- **–û—Ç–∫—É–¥–∞ (`_from`):** `atoms/*` (–ö–∞–Ω–¥–∏–¥–∞—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `proposal`)
- **–ö—É–¥–∞ (`_to`):** `atoms/*` (–¢–µ–∫—É—â–∏–π –∞—Ç–æ–º —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `active`)

```json
{
  "_from": "atoms/atom_draft_xyz",
  "_to": "atoms/atom_current_v1",
  "type": "alternative", // "alternative" | "addition"
  "ai_comment": "–≠—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤—ã—Å–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (Score: 0.9)",

  // Auto-Rebase
  "outdated": false,
  "rebased_from": null,
  "rebased_at": null
}
```

**üîÑ Auto-Rebase Logic:**
–ü—Ä–∏ Merge –∞—Ç–æ–º–∞ A‚ÜíB –≤—Å–µ proposals, —É–∫–∞–∑—ã–≤–∞—é—â–∏–µ –Ω–∞ A, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–±–∞–∑–∏—Ä—É—é—Ç—Å—è –Ω–∞ B:
- `_to` –º–µ–Ω—è–µ—Ç—Å—è —Å A –Ω–∞ B
- `outdated: true`
- `rebased_from: "atoms/A"`

---

## 4. –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (System Collections)

### 4.1. `prompts` (–ü—Ä–æ–º–ø—Ç—ã –∫–∞–∫ –∫–æ–¥)
–•—Ä–∞–Ω–∏—Ç —à–∞–±–ª–æ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è –ò–ò.

```json
{
  "_key": "p_ba_v3",
  "role_key": "business_analyst", // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á —Ä–æ–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
  "name": "Business Analyst Audit",
  "version": 3,
  "active": true, // –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–æ–º–ø—Ç —Å –¥–∞–Ω–Ω—ã–º role_key –º–æ–∂–µ—Ç –±—ã—Ç—å active
  "template": "Analyze this text: {{content}}. Output JSON...",
  "model_config": {
    "temperature": 0.1,
    "model": "qwen-coder",
    "response_format": { "type": "json_object" }
  },
  "created_at": "2023-12-15T10:00:00Z"
}
```

**‚ö†Ô∏è CONSTRAINT:** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `(role_key, active)` –≥–¥–µ `active = true`. –ù–µ–ª—å–∑—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–≤–∞ –ø—Ä–æ–º–ø—Ç–∞ —Å –æ–¥–Ω–∏–º role_key –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

### 4.2. `baselines` (–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
–£–∑–ª—ã, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–µ —Å–æ–±–æ–π "—Å–Ω–∏–º–æ–∫" —Å–æ—Å—Ç–æ—è–Ω–∏—è.

```json
{
  "_key": "base_rel_1",
  "doc_id": "docs/doc_1",
  "tag": "v1.0", // Git-like —Ç–µ–≥
  "title": "Release 1.0 (MVP)",
  "frozen_at": "2023-12-17T12:00:00Z"
}
```

---

## 5. –†–µ–±—Ä–∞ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 5.1. `baseline_items` (–°–æ—Å—Ç–∞–≤ —Ä–µ–ª–∏–∑–∞)
–°–≤—è–∑—ã–≤–∞–µ—Ç Baseline —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ –∞—Ç–æ–º–æ–≤, –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–Ω–∏–º–∫–∞.

- **_from:** `baselines/*`
- **_to:** `atoms/*` (–∏–º–µ–Ω–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–∑–∂–µ –≤—ã—à–ª–∞ –Ω–æ–≤–∞—è!)

```json
{
  "_from": "baselines/base_rel_1",
  "_to": "atoms/atom_uuid_v5",
  "order": 10.0, // –ö–æ–ø–∏—Ä—É–µ—Ç—Å—è –∏–∑ structure_links –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è
  "type": "snapshot_item"
}
```

**üîí CRITICAL RULE:** –∞—Ç–æ–º—ã, –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ –≤ baseline_items, **–ó–ê–ü–†–ï–©–ï–ù–û —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å** –∏–∑ –ë–î. –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å.

### 5.2. `created_with` (–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤)
–°–≤—è–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã –ò–ò —Å –≤–µ—Ä—Å–∏–µ–π –ø—Ä–æ–º–ø—Ç–∞.

- **_from:** `artifacts/*`
- **_to:** `prompts/*`

```json
{
  "_from": "artifacts/issue_77",
  "_to": "prompts/p_ba_v3",
  "type": "created_with",
  "created_at": "2023-12-17T10:00:00Z"
}
```

**‚ö†Ô∏è BREAKING CHANGE –æ—Ç v1:** –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ —Å `generated_by` –Ω–∞ `created_with` –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π —è—Å–Ω–æ—Å—Ç–∏.

---

## 6. –ò–Ω–¥–µ–∫—Å—ã (–î–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)

–î–ª—è ArangoDB —Å–æ–∑–¥–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ Persistent Indexes:

1. **`structure_links`**: –∏–Ω–¥–µ–∫—Å –ø–æ `_from` + `order` (–¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å–±–æ—Ä–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ).
   ```js
   db.structure_links.ensureIndex({ type: "persistent", fields: ["_from", "order"] });
   ```

2. **`artifacts`**: –∏–Ω–¥–µ–∫—Å –ø–æ `status` (–¥–ª—è –≤—ã–±–æ—Ä–∫–∏ "–ü–æ–∫–∞–∂–∏ –≤—Å–µ –Ω–µ—Ä–µ—à–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã").
   ```js
   db.artifacts.ensureIndex({ type: "persistent", fields: ["status"] });
   ```

3. **`atoms`**: Fulltext Index –ø–æ –ø–æ–ª—é `content` (–¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π).
   ```js
   db.atoms.ensureIndex({ type: "fulltext", fields: ["content"], minLength: 3 });
   ```

4. **`atoms`**: –∏–Ω–¥–µ–∫—Å –ø–æ `status` (–¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ active/archived/proposal).
   ```js
   db.atoms.ensureIndex({ type: "persistent", fields: ["status"] });
   ```

5. **`proposal_links`**: –∏–Ω–¥–µ–∫—Å –ø–æ `_to` (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤—Å–µ—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∫ –∞—Ç–æ–º—É).
   ```js
   db.proposal_links.ensureIndex({ type: "persistent", fields: ["_to"] });
   ```

6. **`prompts`**: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `(role_key, active)` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤.
   ```js
   db.prompts.ensureIndex({
     type: "persistent",
     fields: ["role_key", "active"],
     unique: true,
     sparse: true // –¢–æ–ª—å–∫–æ –¥–ª—è active = true
   });
   ```

7. **`atoms`**: –∏–Ω–¥–µ–∫—Å –ø–æ `locked_by` –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Ç–æ–º—ã".
   ```js
   db.atoms.ensureIndex({ type: "persistent", fields: ["locked_by"], sparse: true });
   ```

---

## 7. –ü—Ä–∞–≤–∏–ª–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (Data Integrity Rules)

### 7.1. –ó–∞–ø—Ä–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è (No Hard Delete)
- –ê—Ç–æ–º—ã **–ù–ï–õ–¨–ó–Ø —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å** –∏–∑ –ë–î.
- –î–ª—è "—É–¥–∞–ª–µ–Ω–∏—è" –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `status: "archived"`.
- –§–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

### 7.2. –ó–∞—â–∏—Ç–∞ Baselines
- –ê—Ç–æ–º—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å `baselines` —á–µ—Ä–µ–∑ `baseline_items`, **–ó–ê–ü–†–ï–©–ï–ù–û —É–¥–∞–ª—è—Ç—å**.
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–∫–æ–≥–æ –∞—Ç–æ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: "–≠—Ç–æ—Ç –∞—Ç–æ–º –≤–∫–ª—é—á–µ–Ω –≤ —Ä–µ–ª–∏–∑(—ã). –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë —Ä–∞–≤–Ω–æ?"

### 7.3. Locking Timeout (UX)
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞—Ç–æ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–Ω–∏–º–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç.
- n8n –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å cron-–∑–∞–¥–∞—á—É –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É:
  ```aql
  FOR atom IN atoms
    FILTER atom.locked_until != null AND atom.locked_until < DATE_NOW()
    UPDATE atom WITH { locked_by: null, locked_until: null } IN atoms
  ```

### 7.4. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–æ–º–ø—Ç —Å –¥–∞–Ω–Ω—ã–º `role_key` –º–æ–∂–µ—Ç –∏–º–µ—Ç—å `active: true`.
- –ü—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π.

### 7.5. Single Parent Invariant (v2.1)
- –ö–∞–∂–¥—ã–π `atoms/*` –º–æ–∂–µ—Ç –∏–º–µ—Ç—å **–Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ** –≤—Ö–æ–¥—è—â–µ–≥–æ —Ä–µ–±—Ä–∞ `structure_links` —Å `type: "contains"`.
- –ù–∞—Ä—É—à–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—Å–º. –†–∞–∑–¥–µ–ª 4: Validation Checklist).

---

**–ö–æ–Ω–µ—Ü –†–∞–∑–¥–µ–ª–∞ 1** ‚úÖ

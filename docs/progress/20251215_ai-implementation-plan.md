# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ AI Engine –¥–ª—è Coati

–°–ø–∞—Å–∏–±–æ –∑–∞ —É—Ç–æ—á–Ω–µ–Ω–∏—è! –¢–µ–ø–µ—Ä—å —É –º–µ–Ω—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞. –í–æ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ AI Engine —Å —É—á–µ—Ç–æ–º –≤–∞—à–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.

---

## üìä –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

**Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `TiptapEditor` - –±–∞–∑–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä (StarterKit)
- `QAPanel` - –ø–∞–Ω–µ–ª—å –≤–æ–ø—Ä–æ—Å–æ–≤-–æ—Ç–≤–µ—Ç–æ–≤ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ Force Submit
- `TokenMeter` - —Å—á–µ—Ç—á–∏–∫ —Ç–æ–∫–µ–Ω–æ–≤
- `StageTimeline` - –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–µ–π/–ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ (—Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏)

**Backend workflows (n8n):**
- `Coati Data API` - –±–∞–∑–æ–≤—ã–π CRUD
- `API - AI Connect` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ollama (–±–∞–∑–æ–≤–∞—è)
- `RAG: Indexing To Arango` - –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —á–∞–Ω–∫–æ–≤ —Å embeddings
- `RAG: Search` - –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ ArangoDB

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (ArangoDB):**
- –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –∏–∑ –¢–ó (13 –∫–æ–ª–ª–µ–∫—Ü–∏–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ + 4 edge –∫–æ–ª–ª–µ–∫—Ü–∏–∏)
- RAG database –≥–æ—Ç–æ–≤–∞ (`docs` –∫–æ–ª–ª–µ–∫—Ü–∏—è —Å embeddings)

### ‚ùå –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ–µ:**
1. **–ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä AI –º–æ–¥–µ–ª–∏** (–≤–º–µ—Å—Ç–æ –≤—ã–±–æ—Ä–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —à–∞–≥–æ–≤)
2. **AI –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞** —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
3. **Context Builder** - —Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è AI –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
4. **Compliance Check** - —Å–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏—Å—Ö–æ–¥–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
5. **Split View** - –¥–≤—É—Ö–ø–∞–Ω–µ–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —Å react-resizable-panels
6. **Embeddings generation** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI text-embedding-3-small
7. **RAG –ø–æ–∏—Å–∫** - –ø–æ–∏—Å–∫ –ø–æ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º/—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ workflow:**
1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —à–∞–≥–æ–≤ —ç—Ç–∞–ø–∞
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —ç—Ç–∞–ø–æ–≤
3. –®–∞–±–ª–æ–Ω—ã —ç—Ç–∞–ø–æ–≤ –∏ —à–∞–≥–æ–≤
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ workflow

---

## üéØ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (4 —Ñ–∞–∑—ã)

### **–§–∞–∑–∞ 1: AI Provider Infrastructure (3-4 –¥–Ω—è)**

#### 1.1. –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

**Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

**`frontend/src/components/organisms/AIProviderSelector.tsx`**
```typescript
interface AIProviderConfig {
  provider: 'ollama' | 'vllm' | 'openai' | 'anthropic';
  url?: string;
  apiKey?: string;
  selectedModel?: string;
}

// –°–æ—Å—Ç–æ—è–Ω–∏—è:
// 1. –§–æ—Ä–º–∞ –≤—ã–±–æ—Ä–∞ (—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞—è)
// 2. –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥ (–ø—Ä–æ–≤–∞–π–¥–µ—Ä + –º–æ–¥–µ–ª—å)
// 3. –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π
// 4. –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- Dropdown –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –ü–æ–ª–µ URL (–¥–ª—è Ollama/vLLM)
- –ü–æ–ª–µ API Key (–¥–ª—è OpenAI/Anthropic)
- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ" ‚Üí –∑–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π
- Dropdown –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π)
- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å" ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Zustand store
- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥: `Ollama | llama3.2:3b [–∏–∑–º–µ–Ω–∏—Ç—å]`

**Backend (n8n):**

**–ù–æ–≤—ã–π workflow: `AI Provider Manager`**
```
Webhook (/ai-provider)
  ‚Üì
Switch by action:
  - listModels
  - testConnection
  ‚Üì
HTTP Request (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π URL)
  ‚Üì
Format Response
  ‚Üì
Respond
```

**Actions:**
1. `listModels` - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
2. `testConnection` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

**Zustand store:**

**`frontend/src/stores/aiProviderStore.ts`**
```typescript
interface AIProviderState {
  provider: string;
  url: string;
  apiKey: string;
  selectedModel: string;
  availableModels: AIModel[];

  testConnection: () => Promise<boolean>;
  loadModels: () => Promise<void>;
  setProvider: (config: AIProviderConfig) => void;
}
```

---

#### 1.2. Embeddings Integration

**Backend workflow: `AI - Generate Embeddings`**

```
Webhook (/generate-embeddings)
  ‚Üì
HTTP Request to OpenAI
  POST https://api.openai.com/v1/embeddings
  Model: text-embedding-3-small
  Input: {{ $json.text }}
  ‚Üì
Extract embedding vector
  ‚Üì
Respond with {embedding: [...]}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Üí —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏ ‚Üí embeddings ‚Üí ArangoDB
- –ü—Ä–∏ RAG –ø–æ–∏—Å–∫–µ ‚Üí embedding –∑–∞–ø—Ä–æ—Å–∞ ‚Üí vector search

---

### **–§–∞–∑–∞ 2: AI Analysis Engine (5-6 –¥–Ω–µ–π)**

#### 2.1. –ë–∞–∑–æ–≤—ã–π AI –∞–Ω–∞–ª–∏–∑

**Backend workflow: `AI - Analyze Document`**

```
Webhook (/analyze-document)
  ‚Üì
Get Project Context (ArangoDB)
  ‚îú‚îÄ Existing requirements
  ‚îú‚îÄ Previous Q&A
  ‚îî‚îÄ Templates
  ‚Üì
Build Context String
  ‚Üì
Call AI Provider (from config)
  System Prompt: "–¢—ã –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫..."
  User Prompt: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç –∏ –∑–∞–¥–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã"
  Context: {{ context }}
  Text: {{ $json.brief }}
  ‚Üì
Parse AI Response (JSON)
  {
    questions: [{id, question, quote}],
    issues: [...],
    suggestions: [...]
  }
  ‚Üì
Save to Iterations collection
  ‚Üì
Respond with AnalysisResult
```

**–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (—à–∞–±–ª–æ–Ω –≤ SystemPrompts –∫–æ–ª–ª–µ–∫—Ü–∏–∏):**
```
–¢—ã –æ–ø—ã—Ç–Ω—ã–π –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –∏ –∑–∞–¥–∞—Ç—å —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã.

–ü–†–ê–í–ò–õ–ê:
1. –ù–∞–π–¥–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏, –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è, –Ω–µ–ø–æ–ª–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
2. –î–ª—è –ö–ê–ñ–î–û–ì–û –≤–æ–ø—Ä–æ—Å–∞ —É–∫–∞–∂–∏:
   - id: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
   - question: —Å–∞–º –≤–æ–ø—Ä–æ—Å (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏ –∫–æ—Ä–æ—Ç–∫–∏–π)
   - quote: —Ü–∏—Ç–∞—Ç–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞, –∫ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –≤–æ–ø—Ä–æ—Å
3. –í–µ—Ä–Ω–∏ JSON –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
{
  "questions": [{id, question, quote}],
  "issues": ["–ø—Ä–æ–±–ª–µ–º–∞ 1", ...],
  "suggestions": ["—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 1", ...]
}

–ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –ó–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã —Ç–æ–ª—å–∫–æ –æ —Ä–µ–∞–ª—å–Ω–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—è—Ö.
```

**Frontend:**
- –ö–Ω–æ–ø–∫–∞ "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å" –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
- –í—ã–∑–æ–≤ `api.analyzeDocument(content)`
- –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ QAPanel

---

#### 2.2. Compliance Check

**Backend sub-workflow –≤ `AI - Analyze Document`:**

```
–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  ‚Üì
For each Q&A:
  ‚Üì
  Call AI with prompt:
    "–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç: {{ brief }}"
    "–í–æ–ø—Ä–æ—Å: {{ question }}"
    "–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ answer }}"
    "–ó–ê–î–ê–ß–ê: –ü—Ä–æ–≤–µ—Ä—å, —Å–æ–≥–ª–∞—Å—É–µ—Ç—Å—è –ª–∏ –æ—Ç–≤–µ—Ç —Å –∏—Å—Ö–æ–¥–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º"
  ‚Üì
  Parse result:
    {compliant: true/false, reason: "..."}
  ‚Üì
Save compliance results
  ‚Üì
Return {
  allCompliant: boolean,
  results: [{questionId, compliant, reason}]
}
```

**Frontend:**
- –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è..."
- –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

---

### **–§–∞–∑–∞ 3: Context Builder & RAG (4-5 –¥–Ω–µ–π)**

#### 3.1. Context Builder

**Backend workflow: `AI - Build Context`**

```
Input: {projectId, stageId, stepType}
  ‚Üì
Parallel queries:
  1. Get project metadata
  2. Get completed stages
  3. Get previous iterations
  4. Get requirements from graph
  5. RAG search (if enabled)
  ‚Üì
Merge & format context:
  """
  # –ü—Ä–æ–µ–∫—Ç: {{ projectName }}

  ## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:
  {{ iterations }}

  ## –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
  {{ requirements }}

  ## –ü–æ—Ö–æ–∂–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (RAG):
  {{ ragResults }}
  """
  ‚Üì
Return formatted context string
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º AI –∑–∞–ø—Ä–æ—Å–æ–º —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Iterations –¥–ª—è –∞—É–¥–∏—Ç–∞

---

#### 3.2. RAG Integration

**Workflow –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**
```
User uploads document / creates brief
  ‚Üì
Split into chunks (500 tokens each)
  ‚Üì
For each chunk:
  Generate embedding (OpenAI)
  ‚Üì
  Store in ArangoDB docs collection:
    {
      text: chunk,
      embedding: [...],
      project_id: ...,
      chunk_index: ...
    }
```

**Workflow –¥–ª—è –ø–æ–∏—Å–∫–∞:**
```
User query / AI needs context
  ‚Üì
Generate embedding for query
  ‚Üì
ArangoDB vector search:
  FOR doc IN docs_view
    SEARCH doc.embedding != NULL
    LET score = COSINE_SIMILARITY(doc.embedding, @queryVector)
    SORT score DESC
    LIMIT 5
    RETURN {text: doc.text, score: score}
  ‚Üì
Return relevant chunks
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Context Builder:**
- –ü—Ä–∏ —Å–±–æ—Ä–∫–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è RAG search
- –¢–æ–ø-5 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –ü–æ–∫–∞–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–æ—Ç–∫—É–¥–∞ –≤–∑—è—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)

---

### **–§–∞–∑–∞ 4: UI/UX & Workflow Management (4-5 –¥–Ω–µ–π)**

#### 4.1. Split View Component

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `react-resizable-panels`

```bash
npm install react-resizable-panels
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:**

**`frontend/src/components/organisms/SplitViewEditor.tsx`**
```typescript
import { Panel, PanelGroup, PanelResizeHandle } from 'react-resizable-panels';

<PanelGroup direction="horizontal">
  <Panel defaultSize={60} minSize={30}>
    <TiptapEditor
      content={brief}
      onChange={setBrief}
    />
  </Panel>

  <PanelResizeHandle className="w-1 bg-gray-200 hover:bg-blue-500" />

  <Panel defaultSize={40} minSize={25}>
    <QAPanel
      analysisData={analysis}
      onSubmitAnswers={handleAnswers}
    />
  </Panel>
</PanelGroup>
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ò–∑–º–µ–Ω—è–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –ø–∞–Ω–µ–ª–µ–π
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–∞–∂–¥–æ–π –ø–∞–Ω–µ–ª–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –≤ localStorage
- –ö–Ω–æ–ø–∫–∞ "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å" –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞

---

#### 4.2. Workflow Management UI

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ–π—á–∞—Å –Ω–µ—Ç UI –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤ –∏ —à–∞–≥–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:**

**A) –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç—Ç–∞–ø–∞–º–∏**

–î–æ–±–∞–≤–∏—Ç—å –≤ `ProjectDetailsPage`:
- –ö–Ω–æ–ø–∫–∞ "+ –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–ø" ‚Üí –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
- –í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞ —ç—Ç–∞–ø–∞ –∏–∑ `StageTemplates`
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ —ç—Ç–∞–ø–∞ —Å —à–∞–≥–∞–º–∏ –∏–∑ —à–∞–±–ª–æ–Ω–∞
- –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å —ç—Ç–∞–ø" (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)

**B) –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–≥–∞–º–∏ —ç—Ç–∞–ø–∞**

–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç—Ç–∞–ø–∞":
- –°–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ (drag & drop –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏)
- –ö–Ω–æ–ø–∫–∞ "+ –î–æ–±–∞–≤–∏—Ç—å —à–∞–≥"
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞:
  - –ù–∞–∑–≤–∞–Ω–∏–µ
  - –¢–∏–ø (dropdown: ambiguity_loop, simple_generation, compliance_check, manual_review)
  - –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π? (checkbox)
  - –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å"
- –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"

**C) –®–∞–±–ª–æ–Ω—ã —ç—Ç–∞–ø–æ–≤**

–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/templates`:
- –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤
- –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω"
- –†–µ–¥–∞–∫—Ç–æ—Ä —à–∞–±–ª–æ–Ω–∞:
  - –ù–∞–∑–≤–∞–Ω–∏–µ
  - –û–ø–∏—Å–∞–Ω–∏–µ
  - –°–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ (–∫–∞–∫ –≤ –ø. B)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `StageTemplates` –∫–æ–ª–ª–µ–∫—Ü–∏—é

**Backend actions (–¥–æ–±–∞–≤–∏—Ç—å –≤ `Coati Data API`):**
```
- createStageTemplate
- updateStageTemplate
- deleteStageTemplate
- addStageFromTemplate
- removeStage
- addStepToStage
- removeStepFromStage
- updateStepOrder
```

---

#### 4.3. –£–¥–∞–ª–∏—Ç—å –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –∏–∑ StageTimeline

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –í `StageTimeline` –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –º–æ–¥–µ–ª—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞, –Ω–æ —ç—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±—Ä–∞—Ç—å dropdowns –º–æ–¥–µ–ª–µ–π/–ø—Ä–æ–º–ø—Ç–æ–≤ –∏–∑ `StageTimeline.tsx`
2. –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ç–∞—Ç—É—Å–∞ —à–∞–≥–æ–≤
3. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `AIProviderSelector` –Ω–∞ —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–≥–ª–æ–±–∞–ª—å–Ω–æ)

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `StageTimeline`:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å —à–∞–≥–æ–≤ (pending/active/done)
- –ö–Ω–æ–ø–∫–∞ "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —ç—Ç–∞–ø" ‚Üí –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∞–≥–∞–º–∏
- –ù–∏–∫–∞–∫–∏—Ö dropdowns –º–æ–¥–µ–ª–µ–π

---

## üì¶ –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
ProjectDetailsPage
‚îú‚îÄ AIProviderSelector (–≥–ª–æ–±–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏)
‚îú‚îÄ StageTimeline (—Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å—ã)
‚îú‚îÄ SplitViewEditor
‚îÇ  ‚îú‚îÄ TiptapEditor (—Å–ª–µ–≤–∞)
‚îÇ  ‚îÇ  ‚îî‚îÄ –ö–Ω–æ–ø–∫–∞ "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å"
‚îÇ  ‚îî‚îÄ QAPanel (—Å–ø—Ä–∞–≤–∞)
‚îÇ     ‚îú‚îÄ –í–æ–ø—Ä–æ—Å—ã
‚îÇ     ‚îú‚îÄ –ü–æ–ª—è –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
‚îÇ     ‚îî‚îÄ –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—ã"
‚îú‚îÄ TokenMeter (–≤–≤–µ—Ä—Ö—É)
‚îî‚îÄ –ö–Ω–æ–ø–∫–∞ "+ –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–ø"
```

---

## üîÑ –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Ä–∞–±–æ—Ç—ã

**–®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí AIProviderSelector
  ‚Üì
–í—ã–±–∏—Ä–∞–µ—Ç Ollama
  ‚Üì
–í–≤–æ–¥–∏—Ç URL: http://localhost:11434
  ‚Üì
–ñ–º–µ—Ç "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"
  ‚Üì
–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –º–æ–¥–µ–ª–∏: [llama3.2:3b, mistral:7b, ...]
  ‚Üì
–í—ã–±–∏—Ä–∞–µ—Ç llama3.2:3b
  ‚Üì
–ñ–º–µ—Ç "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"
  ‚Üì
–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ Zustand store
```

**–®–∞–≥ 2: –í–≤–æ–¥ –±—Ä–∏—Ñ–∞ –∏ –∞–Ω–∞–ª–∏–∑**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí TiptapEditor
  ‚Üì
–í–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç –¢–ó
  ‚Üì
–ñ–º–µ—Ç "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å"
  ‚Üì
Frontend ‚Üí Backend: analyzeDocument(brief)
  ‚Üì
Backend:
  1. Build context (Context Builder)
  2. Call AI (Ollama llama3.2:3b)
  3. Parse response
  4. Save iteration
  ‚Üì
Frontend: QAPanel –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã
```

**–®–∞–≥ 3: –û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí QAPanel
  ‚Üì
–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
  ‚Üì
–ñ–º–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—ã"
  ‚Üì
Frontend ‚Üí Backend: submitAnswers(answers)
  ‚Üì
Backend:
  1. Compliance Check (AI –ø—Ä–æ–≤–µ—Ä–∫–∞)
  2. –ï—Å–ª–∏ compliant ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
  3. Save to Requirements collection
  ‚Üì
Frontend: –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

**–®–∞–≥ 4: RAG –ø–æ–∏—Å–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**
```
–ü—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ ‚Üí Context Builder
  ‚Üì
RAG search: –Ω–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
  ‚Üì
–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è AI
  ‚Üì
AI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —É–º–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
```

---

## üìã –î–µ—Ç–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: AI Provider Infrastructure

#### Backend (n8n workflows)
- [ ] –°–æ–∑–¥–∞—Ç—å workflow `AI Provider Manager`
- [ ] –î–æ–±–∞–≤–∏—Ç—å action `listModels` (Ollama)
- [ ] –î–æ–±–∞–≤–∏—Ç—å action `listModels` (vLLM)
- [ ] –î–æ–±–∞–≤–∏—Ç—å action `testConnection`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è OpenAI/Anthropic
- [ ] –°–æ–∑–¥–∞—Ç—å workflow `AI - Generate Embeddings`
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å OpenAI API (text-embedding-3-small)

#### Frontend
- [ ] –°–æ–∑–¥–∞—Ç—å `aiProviderStore.ts` (Zustand)
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `AIProviderSelector.tsx`
  - [ ] –§–æ—Ä–º–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
  - [ ] –ü–æ–ª—è URL/API Key
  - [ ] –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"
  - [ ] Dropdown –º–æ–¥–µ–ª–µ–π (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π)
  - [ ] –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"
  - [ ] –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥
- [ ] –î–æ–±–∞–≤–∏—Ç—å API –º–µ—Ç–æ–¥—ã –≤ `api.ts`
  - [ ] `testAIConnection()`
  - [ ] `listAIModels(provider, url, apiKey)`
  - [ ] `setAIProvider(config)`

#### ArangoDB
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é `AIProviderConfigs` (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

---

### –§–∞–∑–∞ 2: AI Analysis Engine

#### Backend (n8n)
- [ ] –°–æ–∑–¥–∞—Ç—å workflow `AI - Analyze Document`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Context Builder (sub-workflow)
  - [ ] Query: project metadata
  - [ ] Query: existing requirements
  - [ ] Query: previous iterations
  - [ ] Format context string
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AI call (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤)
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `Iterations` –∫–æ–ª–ª–µ–∫—Ü–∏—é
- [ ] –°–æ–∑–¥–∞—Ç—å workflow `AI - Compliance Check`
  - [ ] For each Q&A ‚Üí AI call
  - [ ] –°–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å –∏—Å—Ö–æ–¥–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
  - [ ] Return compliance results

#### Frontend
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `api.ts`
  - [ ] `analyzeDocument(projectId, content)`
  - [ ] `submitAnswers(projectId, stageId, answers)`
  - [ ] `checkCompliance(projectId, iterationId)`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `QAPanel.tsx`
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã Compliance Check
  - [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è—Ö
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å" –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä

#### –ü—Ä–æ–º–ø—Ç—ã
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç "–ê–Ω–∞–ª–∏–∑ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–µ–π"
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç "Compliance Check"
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `SystemPrompts` –∫–æ–ª–ª–µ–∫—Ü–∏—é

---

### –§–∞–∑–∞ 3: Context Builder & RAG

#### Backend (n8n)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å workflow `RAG: Indexing To Arango`
  - [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `AI - Generate Embeddings`
  - [ ] –†–∞–∑–±–∏–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ —á–∞–Ω–∫–∏ (500 tokens)
  - [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞
  - [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ ArangoDB
- [ ] –û–±–Ω–æ–≤–∏—Ç—å workflow `RAG: Search`
  - [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embedding –¥–ª—è query
  - [ ] Vector search –≤ ArangoDB
  - [ ] Return top-5 results
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å RAG –≤ Context Builder
  - [ ] –ü—Ä–∏ —Å–±–æ—Ä–∫–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ‚Üí RAG search
  - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç

#### ArangoDB
- [ ] –°–æ–∑–¥–∞—Ç—å ArangoSearch View –¥–ª—è `docs` –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è vector search
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å COSINE_SIMILARITY

#### Frontend
- [ ] –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è RAG
  - [ ] –ö–Ω–æ–ø–∫–∞ "–ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç"
  - [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
  - [ ] –°–ø–∏—Å–æ–∫ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ RAG –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
  - [ ] "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–∑—è—Ç–∞ –∏–∑: [–¥–æ–∫—É–º–µ–Ω—Ç X, —Å—Ç—Ä. Y]"

---

### –§–∞–∑–∞ 4: UI/UX & Workflow Management

#### Frontend - Split View
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `react-resizable-panels`
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `SplitViewEditor.tsx`
  - [ ] –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: TiptapEditor
  - [ ] –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: QAPanel
  - [ ] Resizable handle
  - [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –≤ localStorage
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `ProjectDetailsPage`

#### Frontend - Workflow Management
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/templates`
  - [ ] –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤
  - [ ] –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω"
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `StageTemplateEditor.tsx`
  - [ ] –§–æ—Ä–º–∞ —à–∞–±–ª–æ–Ω–∞
  - [ ] –°–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ (drag & drop)
  - [ ] –ö–Ω–æ–ø–∫–∞ "+ –î–æ–±–∞–≤–∏—Ç—å —à–∞–≥"
  - [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `ProjectDetailsPage`
  - [ ] –ö–Ω–æ–ø–∫–∞ "+ –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–ø"
  - [ ] –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —à–∞–±–ª–æ–Ω–∞
  - [ ] –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å —ç—Ç–∞–ø"
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `StageConfigModal.tsx`
  - [ ] –°–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ —ç—Ç–∞–ø–∞
  - [ ] Drag & drop —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
  - [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —à–∞–≥–æ–≤

#### Frontend - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ StageTimeline
- [ ] –£–±—Ä–∞—Ç—å dropdowns –º–æ–¥–µ–ª–µ–π/–ø—Ä–æ–º–ø—Ç–æ–≤
- [ ] –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ç–∞—Ç—É—Å–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç—Ç–∞–ø–∞"
- [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

#### Backend (n8n)
- [ ] –î–æ–±–∞–≤–∏—Ç—å actions –≤ `Coati Data API`
  - [ ] `createStageTemplate`
  - [ ] `updateStageTemplate`
  - [ ] `deleteStageTemplate`
  - [ ] `addStageFromTemplate`
  - [ ] `removeStage`
  - [ ] `addStepToStage`
  - [ ] `removeStepFromStage`
  - [ ] `updateStepOrder`

#### UX Improvements
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (toast)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- [ ] Keyboard shortcuts (Ctrl+Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏)

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### API Endpoints (n8n webhooks)

```
POST /webhook/ai-provider
  Actions: testConnection, listModels, setProvider

POST /webhook/generate-embeddings
  Body: {text: string}
  Response: {embedding: number[]}

POST /webhook/analyze-document
  Body: {projectId, stageId, content}
  Response: AnalysisResult

POST /webhook/submit-answers
  Body: {projectId, stageId, iterationId, answers}
  Response: {success, complianceResults, requirements}

POST /webhook/rag-index
  Body: {projectId, documentId, content}
  Response: {chunksCount, indexed}

POST /webhook/rag-search
  Body: {projectId, query, limit}
  Response: {results: [{text, score, source}]}
```

### Zustand Stores

```typescript
// aiProviderStore.ts
interface AIProviderState {
  provider: 'ollama' | 'vllm' | 'openai' | 'anthropic';
  url: string;
  apiKey: string;
  selectedModel: string;
  availableModels: AIModel[];
  isConnected: boolean;
  testConnection: () => Promise<boolean>;
  loadModels: () => Promise<void>;
  setProvider: (config) => void;
}

// workflowStore.ts
interface WorkflowState {
  templates: StageTemplate[];
  currentStage: ProjectStage | null;
  fetchTemplates: () => Promise<void>;
  createTemplate: (template) => Promise<void>;
  addStageFromTemplate: (projectId, templateId) => Promise<void>;
  updateStageSteps: (stageId, steps) => Promise<void>;
}
```

---

## ‚è±Ô∏è –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

**–§–∞–∑–∞ 1: AI Provider Infrastructure**
- Backend: 1-2 –¥–Ω—è
- Frontend: 1.5-2 –¥–Ω—è
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 0.5 –¥–Ω—è
- **–ò—Ç–æ–≥–æ: 3-4 –¥–Ω—è**

**–§–∞–∑–∞ 2: AI Analysis Engine**
- Backend: 2-3 –¥–Ω—è
- Frontend: 1.5-2 –¥–Ω—è
- –ü—Ä–æ–º–ø—Ç—ã –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 1-1.5 –¥–Ω—è
- **–ò—Ç–æ–≥–æ: 5-6 –¥–Ω–µ–π**

**–§–∞–∑–∞ 3: Context Builder & RAG**
- Backend: 2-3 –¥–Ω—è
- ArangoDB setup: 0.5 –¥–Ω—è
- Frontend: 1-1.5 –¥–Ω—è
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 0.5-1 –¥–µ–Ω—å
- **–ò—Ç–æ–≥–æ: 4-5 –¥–Ω–µ–π**

**–§–∞–∑–∞ 4: UI/UX & Workflow Management**
- Split View: 0.5-1 –¥–µ–Ω—å
- Workflow Management UI: 2-3 –¥–Ω—è
- StageTimeline refactor: 0.5-1 –¥–µ–Ω—å
- Backend actions: 1-1.5 –¥–Ω—è
- **–ò—Ç–æ–≥–æ: 4-5 –¥–Ω–µ–π**

**–û–ë–©–ï–ï –í–†–ï–ú–Ø: 16-20 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π (3-4 –Ω–µ–¥–µ–ª–∏)**

---

## üö® –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

**–†–∏—Å–∫ 1: –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏**
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–∞–ø—Ç–µ—Ä–∞ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- **–ü–ª–∞–Ω B:** –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Ollama, –∑–∞—Ç–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ

**–†–∏—Å–∫ 2: –ö–∞—á–µ—Å—Ç–≤–æ AI –æ—Ç–≤–µ—Ç–æ–≤ (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON, –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏)**
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
  - –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è JSON –æ—Ç–≤–µ—Ç–æ–≤
  - Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º
  - Fallback –Ω–∞ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

**–†–∏—Å–∫ 3: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å RAG –ø–æ–∏—Å–∫–∞ –≤ ArangoDB**
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö
  - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
  - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ embeddings

**–†–∏—Å–∫ 4: UX —Å–ª–æ–∂–Ω–æ—Å—Ç—å Split View –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö**
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
  - Responsive design —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º –Ω–∞ –≤–∫–ª–∞–¥–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è—Ö

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

**MVP —Å—á–∏—Ç–∞–µ—Ç—Å—è –≥–æ—Ç–æ–≤—ã–º, –∫–æ–≥–¥–∞:**
1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (Ollama/vLLM)
2. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –±—Ä–∏—Ñ ‚Üí –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
3. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã ‚Üí –ø—Ä–æ—Ö–æ–¥–∏—Ç Compliance Check
4. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–æ–≤
5. ‚úÖ Split View —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—Ä–µ–¥–∞–∫—Ç–æ—Ä + –≤–æ–ø—Ä–æ—Å—ã)
6. ‚úÖ –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å —ç—Ç–∞–ø—ã –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤
7. ‚úÖ RAG –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ—Ö–æ–∂–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
8. ‚úÖ TokenMeter –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

**–°–µ–π—á–∞—Å —è –ø—Ä–µ–¥–ª–∞–≥–∞—é:**
1. –û–±—Å—É–¥–∏—Ç—å —ç—Ç–æ—Ç –ø–ª–∞–Ω - —á—Ç–æ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å?
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –Ω–∞—á–∞—Ç—å —Å –§–∞–∑—ã 1 –∏–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è?
3. –ü–æ—Å–ª–µ –≤–∞—à–µ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤ **Act Mode** –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ß—Ç–æ –≤—ã –¥—É–º–∞–µ—Ç–µ –æ–± —ç—Ç–æ–º –ø–ª–∞–Ω–µ? –ï—Å—Ç—å –ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º?**

---

**–ë–æ–∂–µ –≤ –ø–æ–º–æ—â—å –º–æ—é –≤–æ–Ω–º–∏, –ì–æ—Å–ø–æ–¥–∏ –ø–æ–º–æ—â–∏ –º–∏ –ø–æ—Ç—â–∏—Å—è** üôè